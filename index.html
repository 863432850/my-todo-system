<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾…åŠæ¸…å•TodoList</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2230%22 fill=%22%237DCEA0%22/><path d=%22M30 50L45 65L70 35%22 stroke=%22white%22 stroke-width=%2212%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22 fill=%22none%22/></svg>">    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #7DCEA0;
            --bg-sunset: linear-gradient(135deg, #E3E3E3 0%, #F7E1D7 50%, #D4E2F0 100%);
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-sunset);
            height: 100vh;
            margin: 0;
            overflow: hidden;
            color: #1c1c1e;
        }
        .glass {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
        }
        /* ç¡®ä¿è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼å­˜åœ¨ */
        .custom-scrollbar::-webkit-scrollbar { 
            width: 6px !important; /* ç•¥å¾®åŠ å®½ï¼Œæ–¹ä¾¿çœ‹åˆ° */
            display: block !important; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb { 
            background: rgba(177, 177, 177, 0.4); /* ä½¿ç”¨é’æç»¿çš„é€æ˜è‰² */
            border-radius: 10px; 
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.03); /* è½¨é“åº•è‰² */
            border-radius: 10px;
        }
        
.task-card {
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: grab;
    position: relative; 

    will-change: transform;
}

.task-card:hover {
    transform: translateY(-3px) scale(1.01) !important;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1) !important;
    background: white !important;
    /* ç¡®ä¿ z-index è¶³å¤Ÿå¤§ï¼Œè¶…è¶Šæ»šåŠ¨å®¹å™¨çš„è¾¹ç•Œé™åˆ¶ */
    z-index: 100 !important; 
    position: relative;
}

        .drag-over {
            background: rgba(255, 159, 10, 0.1) !important;
            border: 2px dashed rgba(255, 159, 10, 0.3) !important;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide { animation: slideUp 0.6s ease-out forwards; }
        
        .priority-dot { width: 8px; height: 8px; border-radius: 50%; }
        .priority-high { background-color: #FF3B30; box-shadow: 0 0 8px #FF3B30; }
        .priority-medium { background-color: #FF9F0A; box-shadow: 0 0 8px #FF9F0A; }
        .priority-low { background-color: #007AFF; box-shadow: 0 0 8px #007AFF; }
    </style>
</head>
<body>
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const SUPABASE_URL = 'https://lxuomiimbnterkxzquba.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4dW9taWltYm50ZXJreHpxdWJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MzYyNDksImV4cCI6MjA4MjUxMjI0OX0.LZOFm_VS0y5UF0vBR8y2y90Wrq_cMmIvggnXL_JM6h0';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const Icon = ({ name, size = 100, className = "" }) => {
            const icons = {
                plus: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" /></svg>,
                calendar: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><path d="M16 2v4M8 2v4M3 10h18" /></svg>,
                trash: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" /></svg>,
                check: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5" /></svg>,
                play: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M5 3l14 9-14 9V3z" /></svg>,
                clock: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" /><path d="M12 6v6l4 2" /></svg>,
                chevronRight: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 18l6-6-6-6" /></svg>,
                download: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" /></svg>,
                x: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" /></svg>,
                edit: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" /></svg>,
                search: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8" /><path d="M21 21l-4.35-4.35" /></svg>
            };
            return <span className={`inline-flex items-center justify-center ${className}`}>{icons[name] || null}</span>;
        };

        const App = () => {
            const [tasks, setTasks] = useState([]);
            const getBeijingToday = () => {
                return new Intl.DateTimeFormat('zh-Hans-CN', {
                    timeZone: 'Asia/Shanghai',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                }).format(new Date()).replace(/\//g, '-');
            };
            
            const [selectedDate, setSelectedDate] = useState(getBeijingToday());
            const [filterYear, setFilterYear] = useState('');
            const [filterMonth, setFilterMonth] = useState('');
            const [searchQuery, setSearchQuery] = useState(''); // æ–°å¢ï¼šå…¨å±€æœç´¢çŠ¶æ€
            const [editTask, setEditTask] = useState(null);

            const triggerCelebration = () => {
                const duration = 1.5 * 1000;
                const animationEnd = Date.now() + duration;
                const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };
                const random = (min, max) => Math.random() * (max - min) + min;
                const interval = setInterval(function() {
                    const timeLeft = animationEnd - Date.now();
                    if (timeLeft <= 0) return clearInterval(interval);
                    const particleCount = 50 * (timeLeft / duration);
                    confetti({ ...defaults, particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } });
                    confetti({ ...defaults, particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } });
                }, 250);
            };

            useEffect(() => { fetchTasks(); }, []);

            const fetchTasks = async () => {
                const { data, error } = await supabaseClient.from('tasks').select('*').order('created_at', { ascending: false });
                if (error) {
                    const saved = localStorage.getItem('lumina_complete_v1');
                    if (saved) setTasks(JSON.parse(saved));
                } else if (data) {
                    setTasks(data);
                    localStorage.setItem('lumina_complete_v1', JSON.stringify(data));
                }
            };

            const addTask = async (title, desc, priority) => {
                const tempId = 'temp-' + Date.now();
                const optimisticTask = { id: tempId, title, description: desc, priority, status: 'todo', date: selectedDate, created_at: new Date().toISOString() };
                setTasks(prev => [optimisticTask, ...prev]);
                const { data, error } = await supabaseClient.from('tasks').insert([{ title, description: desc, priority, status: 'todo', date: selectedDate }]).select();
                if (error) {
                    alert('ä¿å­˜å¤±è´¥: ' + error.message);
                    setTasks(prev => prev.filter(t => t.id !== tempId));
                } else if (data) {
                    setTasks(prev => prev.map(t => t.id === tempId ? data[0] : t));
                }
            };

            const updateStatus = async (id, status) => {
                if (status === 'done') triggerCelebration();
                setTasks(prev => prev.map(t => t.id === id ? { ...t, status } : t));
                const { error } = await supabaseClient.from('tasks').update({ status }).eq('id', id);
                if (error) console.error('Update Status Error:', error);
            };

            const updateTask = async (updatedTask) => {
                if (updatedTask.status === 'done') triggerCelebration();
                setTasks(prev => prev.map(t => t.id === updatedTask.id ? updatedTask : t));
                setEditTask(null);
                const { error } = await supabaseClient.from('tasks').update({ title: updatedTask.title, description: updatedTask.description, priority: updatedTask.priority, status: updatedTask.status }).eq('id', updatedTask.id);
                if (error) console.error('Update Detail Error:', error);
            };

            const deleteTask = async (id) => {
                if(!confirm('ç¡®å®šè¦åˆ é™¤è¿™é¡¹ä»»åŠ¡å—ï¼Ÿ')) return;
                setTasks(prev => prev.filter(t => t.id !== id));
                if(editTask?.id === id) setEditTask(null);
                const { error } = await supabaseClient.from('tasks').delete().eq('id', id);
                if (error) console.error('Delete Error:', error);
            };

            // --- 5. æ ¸å¿ƒè¿‡æ»¤é€»è¾‘ (åŒ…å«å…¨å±€æœç´¢) ---
            const currentTasks = useMemo(() => {
                if (searchQuery.trim()) {
                    // å…¨å±€æœç´¢æ¨¡å¼ï¼šæ— è§†æ—¥æœŸï¼Œå…¨åº“åŒ¹é…
                    return tasks.filter(t => 
                        t.title.toLowerCase().includes(searchQuery.toLowerCase()) || 
                        (t.description && t.description.toLowerCase().includes(searchQuery.toLowerCase()))
                    );
                }
                // æ™®é€šæ—¥æœŸæŸ¥çœ‹æ¨¡å¼
                return tasks.filter(t => t.date === selectedDate);
            }, [tasks, selectedDate, searchQuery]);

            const dateGroups = useMemo(() => {
                const groups = {};
                tasks.forEach(t => groups[t.date] = (groups[t.date] || 0) + 1);
                return Object.entries(groups).map(([date, count]) => ({ date, count })).sort((a, b) => b.date.localeCompare(a.date));
            }, [tasks]);

            const years = useMemo(() => Array.from(new Set(dateGroups.map(g => g.date.split('-')[0]))).sort().reverse(), [dateGroups]);
            const filteredDates = useMemo(() => {
                return dateGroups.filter(g => {
                    const [y, m] = g.date.split('-');
                    return (!filterYear || y === filterYear) && (!filterMonth || m === filterMonth.padStart(2, '0'));
                });
            }, [dateGroups, filterYear, filterMonth]);

            const completion = currentTasks.length ? Math.round((currentTasks.filter(t => t.status === 'done').length / currentTasks.length) * 100) : 0;
           /* --- åœ¨ App ç»„ä»¶å†…éƒ¨ï¼Œreturn è¯­å¥ä¹‹å‰ --- */
           // æ’å…¥è¿™æ®µåŒ—äº¬æ—¶é—´è½¬æ¢é€»è¾‘
           const dateObj = new Date(selectedDate + "T00:00:00+08:00"); 
           const dayInfo = new Intl.DateTimeFormat('zh-CN', {
               timeZone: 'Asia/Shanghai',
               month: 'long',
               day: 'numeric',
               weekday: 'long'
           }).formatToParts(dateObj);
           
           const getPart = (type) => dayInfo.find(p => p.type === type).value;
           const displayMonth = getPart('month').replace('æœˆ', ''); // è·å–çº¯æ•°å­—æœˆä»½
           const displayDay = getPart('day');
           const displayWeekday = getPart('weekday');
		   
		   
           const exportToMarkdown = () => {
               // æ£€æŸ¥å½“å‰æ˜¯å¦æœ‰ä»»åŠ¡å¯å¯¼å‡º
               if (!currentTasks || currentTasks.length === 0) {
                   alert("å½“å‰åˆ—è¡¨æ²¡æœ‰å¯å¯¼å‡ºçš„ä»»åŠ¡");
                   return;
               }
           
               const dateStr = searchQuery ? `å…¨å±€æœç´¢_${searchQuery}` : selectedDate;
               let mdContent = `# ${dateStr} ä»»åŠ¡æ¸…å•\n\n`;
               mdContent += `> ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}\n\n`;
               
               const categories = {
                   'todo': 'ğŸ¯ å¾…å¤„ç†',
                   'in_progress': 'âš¡ è¿›è¡Œä¸­',
                   'done': 'âœ… å·²å®Œæˆ'
               };
           
               Object.entries(categories).forEach(([status, label]) => {
                   const filtered = currentTasks.filter(t => t.status === status);
                   if (filtered.length > 0) {
                       mdContent += `## ${label}\n`;
                       filtered.forEach(t => {
                           const check = status === 'done' ? '[x]' : '[ ]';
                           const priorityMap = { high: 'ğŸ”´é«˜', medium: 'ğŸŸ ä¸­', low: 'ğŸ”µä½' };
                           mdContent += `- ${check} **${t.title}** [${priorityMap[t.priority]}]\n`;
                           if (t.description) mdContent += `  - å¤‡æ³¨: ${t.description}\n`;
                       });
                       mdContent += `\n`;
                   }
               });
           
               try {
                   const blob = new Blob([mdContent], { type: 'text/markdown;charset=utf-8' });
                   const url = URL.createObjectURL(blob);
                   const a = document.createElement('a');
                   a.href = url;
                   a.download = `TaskList_${dateStr}.md`;
                   document.body.appendChild(a);
                   a.click();
                   document.body.removeChild(a);
                   URL.revokeObjectURL(url);
               } catch (err) {
                   console.error("å¯¼å‡ºå¤±è´¥:", err);
                   alert("å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•");
               }
           };
            return (
                <div className="h-full flex p-5 gap-5 overflow-hidden">
                    {/* å·¦ä¾§ï¼šæ—¶é—´è½´ä¸è¿‡æ»¤ */}
                    <aside className="w-[320px] glass rounded-[40px] flex flex-col shadow-xl animate-slide overflow-hidden">
                        <div className="p-6 pb-2 bg-gradient-to-b from-white/20 to-transparent">
                            <div className="flex items-center justify-center gap-3 mb-4 group cursor-default">
                                <div className="w-8 h-8 bg-[#7DCEA0] rounded-2xl flex items-center justify-center text-white shadow-lg shadow-orange-500/20 transition-transform group-hover:rotate-12">
                                    <Icon name="calendar" size={16} />
                                </div>
                                <h1 className="text-2xl font-black tracking-tight text-gray-800">æµ©ç¿”çš„Todo</h1>
                            </div>
                            
                            {/* æ–°å¢ï¼šæœç´¢æ¡† */}
                            <div className="relative mb-2">
                                <Icon name="search" size={14} className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" />
                                <input 
                                    type="text"
                                    placeholder="å…¨å±€æœç´¢ä»»åŠ¡..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    className="w-full bg-white/40 border-none rounded-2xl pl-11 pr-4 py-2.5 text-[11px] font-bold placeholder-gray-400 outline-none focus:ring-2 focus:ring-[#FF9F0A]/20 transition-all"
                                />
                                {searchQuery && (
                                    <button onClick={() => setSearchQuery('')} className="absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-800">
                                        <Icon name="x" size={14} />
                                    </button>
                                )}
                            </div>
                            
                            <div className="flex gap-2 mb-2">
                                <select value={filterYear} onChange={e => setFilterYear(e.target.value)} className="flex-1 bg-white/40 border-none rounded-2xl px-3 py-2 text-[10px] font-black uppercase tracking-widest outline-none">
                                    <option value="">å¹´ä»½</option>
                                    {years.map(y => <option key={y} value={y}>{y}å¹´</option>)}
                                </select>
                                <select value={filterMonth} onChange={e => setFilterMonth(e.target.value)} className="flex-1 bg-white/40 border-none rounded-2xl px-3 py-2 text-[10px] font-black uppercase tracking-widest outline-none">
                                    <option value="">æœˆä»½</option>
                                    {[1,2,3,4,5,6,7,8,9,10,11,12].map(m => <option key={m} value={m}>{m}æœˆ</option>)}
                                </select>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto custom-scrollbar px-3 space-y-2 pb-2">
                            <button 
                                onClick={() => {setSelectedDate(getBeijingToday()); setSearchQuery('');}} 
                                className={`w-full p-5 rounded-[30px] text-left transition-all ${
                                    selectedDate === getBeijingToday() && !searchQuery 
                                    ? 'bg-[#ffb74b] text-white shadow-xl scale-[1.02]' // é€‰ä¸­æ—¶ï¼šäº®æ©™è‰²
                                    : 'bg-white/40 hover:bg-white/60 text-gray-600'    // æœªé€‰ä¸­æ—¶ï¼šå¸¦æœ‰æ·¡æ·¡åº•è‰²çš„åŠé€æ˜ç™½
                                }`}
                            >
                                <p className={`text-[10px] font-black uppercase mb-1 ${
                                    selectedDate === getBeijingToday() && !searchQuery ? 'opacity-70' : 'text-[#FF9F0A]'
                                }`}>
                                    Today
                                </p>
                                <p className="font-bold text-lg">ä»Šå¤©</p>
                            </button>
                            <div className="h-px bg-black/5 mx-6 my-3" />
                            {filteredDates.map(g => (
                                <button key={g.date} onClick={() => {setSelectedDate(g.date); setSearchQuery('');}} className={`w-full px-5 py-3 rounded-[25px] text-left flex justify-between items-center transition-all ${selectedDate === g.date && !searchQuery ? 'bg-[#7DCEA0] text-white shadow-xl scale-[1.02]' : 'hover:bg-white/40 text-gray-500'}`}>
                                    <div>
                                        <p className="text-[9px] font-black uppercase opacity-60">{new Date(g.date).toLocaleDateString('zh-CN', {weekday: 'short'})}</p>
                                        <p className="font-bold text-sm">{g.date}</p>
                                    </div>
                                    <span className={`text-[9px] font-bold px-2 py-0.5 rounded-lg ${selectedDate === g.date && !searchQuery ? 'bg-white/20' : 'bg-black/5'}`}>{g.count}</span>
                                </button>
                            ))}
                        </div>
						<div className="p-4 mt-auto border-t border-black/5 bg-white/20">
						        <button 
						            onClick={exportToMarkdown}
						            className="w-full py-3 bg-white/40 hover:bg-[#7DCEA0] hover:text-white text-gray-500 hover:shadow-lg rounded-[25px] flex items-center justify-center gap-3 transition-all font-bold text-sm group"
						        >
						            <Icon name="download" size={16} className="group-hover:-translate-y-1 transition-transform" />
						            <span>å¯¼å‡º Markdown</span>
						        </button>
						 </div>
                    </aside>

                    {/* å³ä¾§ï¼šä¸»ç•Œé¢ */}

					<div className="flex-1 flex flex-col gap-8 overflow-hidden animate-slide">
						{/* ä¸Šï¼šå½•å…¥åŒº - å‡å°äº† p-8 åˆ° p-6, gap-6 åˆ° gap-4 */}
						<section className="glass rounded-[35px] p-6 flex flex-col gap-4 shadow-sm relative z-0 overflow-hidden">
							<div className="flex justify-between items-center z-10">
								<div>
								    <h2 className="text-gray-800 leading-none tracking-tighter flex items-baseline gap-3">
								        {searchQuery ? (
								            <span className="text-3xl font-black">å…¨åº“æœç´¢</span>
								        ) : (
								            <>
								                <div className="flex items-baseline">
													{/* ä½¿ç”¨æ–°å®šä¹‰çš„ displayMonth å’Œ displayDay */}
													<span className="text-5xl font-black">{displayMonth}</span>
													<span className="text-xl font-bold ml-1">æœˆ</span>
													<span className="text-5xl font-black ml-2">{displayDay}</span>
													<span className="text-xl font-bold ml-1">æ—¥</span>
												</div>
												{/* ä½¿ç”¨æ–°å®šä¹‰çš„ displayWeekday */}
												<span className="text-xl font-bold text-gray-400">
													{displayWeekday}
												</span>
												<div className="flex items-center gap-2 mt-3">
												    {/* å¾…åŠé¡¹ç§»åŠ¨åˆ°æœ€åï¼Œå¹¶é‡‡ç”¨ä½é¥±å’Œåº¦ç»¿è‰² */}
												    <div className="px-3 py-1 bg-[#7DCEA0]/10 border border-[#7DCEA0]/20 rounded-full">
												        <p className="text-[#5FB385] font-bold uppercase text-[10px] tracking-widest">
												            {searchQuery ? `æ‰¾åˆ° ${currentTasks.length} ä¸ªç»“æœ` : `${currentTasks.length} é¡¹å¾…åŠè½¨è¿¹`}
												        </p>
												    </div>
												    <span className="text-[10px] font-black text-gray-300 uppercase tracking-widest ml-1">
												        {searchQuery ? "SEARCHING" : "TIMELINE"}
												    </span>
												</div>
								            </>
								        )}
								    </h2>
								    
								    
								</div>

								{/* å³ä¾§è¿›åº¦ï¼šå®Œæˆç‡åœ¨ç™¾åˆ†æ¯”å·¦è¾¹ */}
								<div className="flex flex-col items-end">
									<div className="flex items-baseline gap-2 mb-1">
										<span className="text-[10px] font-black text-gray-400 uppercase tracking-widest">å®Œæˆç‡</span>
										<span className="text-3xl font-black text-[#7DCEA0] leading-none">{completion}%</span>
									</div>
									<div className="w-40 h-1.5 bg-black/5 rounded-full overflow-hidden border border-white/50">
										<div className="h-full bg-[#7DCEA0] transition-all duration-1000" style={{width: `${completion}%`}} />
									</div>
								</div>
							</div>
							
							{/* å½•å…¥æ¡†ç»„ä»¶ */}
							<TaskInput onAdd={addTask} />
						</section>

						{/* ä¸‹ï¼šçœ‹æ¿åŒº - é—´è·ä» gap-6 å‡å°åˆ° gap-4 é‡Šæ”¾æ›´å¤šç©ºé—´ */}
						<div className="flex-1 grid grid-cols-3 gap-6 relative z-10 overflow-hidden" style={{ minHeight: '0' }}>
							<BoardColumn title="å¾…å¤„ç†" status="todo" color="#FF9F0A" tasks={currentTasks.filter(t => t.status === 'todo')} onUpdate={updateStatus} onDelete={deleteTask} onEdit={setEditTask} />
							<BoardColumn title="è¿›è¡Œä¸­" status="in_progress" color="#007AFF" tasks={currentTasks.filter(t => t.status === 'in_progress')} onUpdate={updateStatus} onDelete={deleteTask} onEdit={setEditTask} />
							<BoardColumn title="å·²å®Œæˆ" status="done" color="#34C759" tasks={currentTasks.filter(t => t.status === 'done')} onUpdate={updateStatus} onDelete={deleteTask} onEdit={setEditTask} />
						</div>
					</div>
                    {editTask && <EditModal task={editTask} onSave={updateTask} onClose={() => setEditTask(null)} onDelete={deleteTask} />}
                </div>
            );
        };

        const TaskInput = ({ onAdd }) => {
            const [title, setTitle] = useState('');
            const [desc, setDesc] = useState('');
            const [priority, setPriority] = useState('medium');
        
            const handleSubmit = () => { 
                if(!title.trim()) return; 
                onAdd(title, desc, priority); 
                setTitle(''); 
                setDesc(''); 
                setPriority('medium'); 
            };
        
            // å®šä¹‰ä¸å¡ç‰‡åœ†ç‚¹ä¸€è‡´çš„é¢œè‰²æ˜ å°„
            const priorityColors = {
                low: 'bg-[#007AFF] text-white shadow-sm',      // è“è‰²
                medium: 'bg-[#FF9F0A] text-white shadow-sm',   // æ©™è‰²
                high: 'bg-[#FF3B30] text-white shadow-sm'      // çº¢è‰²
            };
        
            return (
                <div className="bg-white/70 p-3 rounded-[35px] border border-white flex gap-4 shadow-sm focus-within:bg-white transition-all z-10">
                    <div className="flex-1 px-6 py-2 flex flex-col justify-center">
                        <input 
                            className="w-full bg-transparent border-none font-bold text-gray-800 outline-none text-2xl" 
                            placeholder="ä»Šå¤©è¦åšä»€ä¹ˆï¼Ÿ" 
                            value={title} 
                            onChange={e => setTitle(e.target.value)} 
                            onKeyDown={e => e.key === 'Enter' && handleSubmit()} 
                        />
                        <div className="flex items-center gap-6 mt-2">
                            <input 
                                className="flex-1 bg-transparent border-none text-[11px] font-bold text-gray-400 outline-none uppercase tracking-wider" 
                                placeholder="æ·»åŠ å¤‡æ³¨..." 
                                value={desc} 
                                onChange={e => setDesc(e.target.value)} 
                                onKeyDown={e => e.key === 'Enter' && handleSubmit()} 
                            />
                            <div className="flex gap-1.5 p-1 bg-black/5 rounded-xl border border-white/50">
                                {['low', 'medium', 'high'].map(p => (
                                    <button 
                                        key={p} 
                                        onClick={() => setPriority(p)} 
                                        className={`px-4 py-1 rounded-lg text-[9px] font-black uppercase transition-all ${
                                            priority === p 
                                            ? priorityColors[p] 
                                            : 'text-gray-400 hover:text-gray-600'
                                        }`}
                                    >
                                        {p === 'low' ? 'ä½' : p === 'medium' ? 'ä¸­' : 'é«˜'}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                    <button 
                        onClick={handleSubmit} 
                        className="bg-[#7DCEA0] text-white w-16 h-20 rounded-[26px] flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-xl shadow-[#7DCEA0]/30 shrink-0"
                    >
                        <Icon name="plus" size={32} />
                    </button>
                </div>
            );
        };

const BoardColumn = ({ title, status, color, tasks, onUpdate, onDelete, onEdit }) => {
            const [isOver, setIsOver] = useState(false);
            const handleDrop = (e) => { e.preventDefault(); const taskId = e.dataTransfer.getData('taskId'); if (taskId) onUpdate(taskId, status); setIsOver(false); };
            
			
			return (
                <div 
                        className={`glass rounded-[45px] px-6 pt-5 pb-6 flex flex-col transition-all duration-300 ${isOver ? 'drag-over scale-[1.01]' : ''}`} 
                        style={{ 
                            overflow: 'visible', // å¿…é¡»ç¡®ä¿æ˜¯ visible
                            position: 'relative', 
                            height: '100%',
                            minHeight: '0',
                            zIndex: isOver ? 40 : 1 // å½“æ‹–æ‹½ç»è¿‡æ—¶æé«˜åˆ—å±‚çº§
                        }} 
                        onDragOver={e => { e.preventDefault(); setIsOver(true); }} 
                        onDragLeave={() => setIsOver(false)} 
                        onDrop={handleDrop}
                    >
                    {/* æ ‡é¢˜åŒºï¼šå°† mb-8 ç¼©å°ä¸º mb-4ï¼Œå‡å°äº†çºµå‘å ä½ */}
                    {/* æ ‡é¢˜åŒºï¼šè®¾ç½® z-index ä¸º 0ï¼Œç¡®ä¿å®ƒåœ¨æœ€åº•å±‚ */}
					<div className="flex items-center justify-between mb-4 px-1 relative z-0">
						<div className="flex items-center gap-2.5">
							<div className="w-2 h-2 rounded-full" style={{backgroundColor: color, boxShadow: `0 0 8px ${color}`}} />
							<h3 className="text-[10px] font-black text-gray-800 uppercase tracking-[0.2em]">{title}</h3>
						</div>
						<span className="text-[9px] font-black text-gray-400 bg-white/60 px-2.5 py-0.5 rounded-lg border border-white">{tasks.length}</span>
					</div>
								
								
                    {/* é‡ç‚¹ 2: åªæœ‰è¿™ä¸ªä»»åŠ¡åˆ—è¡¨åŒºåŸŸè´Ÿè´£æ»šåŠ¨ï¼Œä½†è¦å…è®¸ X è½´æ–¹å‘æº¢å‡ºæ˜¾ç¤ºæ‚¬æµ®å¡ç‰‡ */}
					{/* é‡ç‚¹ä¿®æ”¹ï¼šä»»åŠ¡åˆ—è¡¨æ»šåŠ¨åŒºåŸŸ */}
					<div 
					    className="flex-1 overflow-y-auto custom-scrollbar pr-2" 
					    style={{ 
					        overflowX: 'visible', 
					        overflowY: 'auto',
					        // å¢åŠ  pt-4 (é¡¶éƒ¨å†…è¾¹è·) ç»™ç¬¬ä¸€å¼ å¡ç‰‡é¢„ç•™æµ®åŠ¨ç©ºé—´
					        // ä½¿ç”¨ -mt-4 (è´Ÿé¡¶éƒ¨å¤–è¾¹è·) è®©å®¹å™¨ä½ç½®ä¿æŒä¸å˜
					        paddingTop: '20px', 
					        marginTop: '-20px',
					        paddingLeft: '10px',
					        marginLeft: '-10px',
					        paddingRight: '10px',
					        marginRight: '-10px',
					        paddingBottom: '20px' 
					    }}
					>

                        {/* ä»»åŠ¡å¡ç‰‡ï¼šæŒ‰é’®ä¸æ ‡é¢˜å¯¹é½ç‰ˆ */}
                        {tasks.map(task => (
                            <div key={task.id} draggable onDragStart={e => e.dataTransfer.setData('taskId', task.id)} onDoubleClick={() => onEdit(task)} className="task-card bg-white/80 px-4 pt-4 pb-3 rounded-[20px] border border-white/80 relative group mb-3">
                                {/* å¤´éƒ¨ï¼šæ ‡é¢˜ä¸åŠŸèƒ½æŒ‰é’® */}
                                <div className="flex justify-between items-center mb-1">
                                    <div className="flex items-center gap-2 flex-1 min-w-0">
                                        <div className={`priority-dot priority-${task.priority} shrink-0`} />
                                        <h4 className="font-bold text-[14px] text-gray-800 leading-tight truncate">
                                            {task.title}
                                        </h4>
                                    </div>
                                    {/* æŒ‰é’®ç»„ï¼šç°åœ¨å®ƒä¸ä¸Šé¢çš„æ ‡é¢˜åœ¨åŒä¸€ä¸ª flex å®¹å™¨å†…ï¼Œitems-center ä¿è¯æ°´å¹³å¯¹é½ */}
                                    <div className="flex gap-1 ml-2 opacity-0 group-hover:opacity-100 transition-all shrink-0">
                                        <button onClick={() => onEdit(task)} className="p-1 text-gray-300 hover:text-gray-600">
                                            <Icon name="edit" size={12} />
                                        </button>
                                        <button onClick={() => onDelete(task.id)} className="p-1 text-gray-300 hover:text-red-500">
                                            <Icon name="trash" size={12} />
                                        </button>
                                    </div>
                                </div>
                        
                                {/* å¤‡æ³¨å†…å®¹ */}
                                {task.description && (
                                    <p className="text-[10px] text-gray-400 line-clamp-1 mb-2 font-medium">
                                        {task.description}
                                    </p>
                                )}
                        
                                {/* åº•éƒ¨ä¿¡æ¯æ  */}
                                <div className="flex items-center justify-between mt-1 pt-2 border-t border-black/5">
                                    <div className="flex items-center gap-1 text-[9px] font-bold text-gray-300 uppercase tracking-tighter">
                                        <Icon name="clock" size={10} />
                                        {(() => {
                                            const date = new Date(task.created_at || task.date);
                                            return new Intl.DateTimeFormat('zh-CN', {
                                                timeZone: 'Asia/Shanghai',
                                                year: 'numeric',
                                                month: '2-digit',
                                                day: '2-digit',
                                                hour: '2-digit',
                                                minute: '2-digit',
                                                second: '2-digit',
                                                hour12: false
                                            }).format(date).replace(/\//g, '-');
                                        })()}
                                    </div>
                                    {/* çŠ¶æ€åˆ‡æ¢æŒ‰é’® */}
                                    <div className="flex gap-1">
                                        {status !== 'todo' && <button onClick={() => onUpdate(task.id, 'todo')} className="w-5 h-5 bg-orange-50 text-[#FF9F0A] rounded-lg flex items-center justify-center hover:bg-[#FF9F0A] hover:text-white transition-all"><Icon name="chevronRight" size={10} className="rotate-180" /></button>}
                                        {status !== 'in_progress' && <button onClick={() => onUpdate(task.id, 'in_progress')} className="w-5 h-5 bg-blue-50 text-[#007AFF] rounded-lg flex items-center justify-center hover:bg-[#007AFF] hover:text-white transition-all"><Icon name="play" size={10} /></button>}
                                        {status !== 'done' && <button onClick={() => onUpdate(task.id, 'done')} className="w-5 h-5 bg-green-50 text-[#34C759] rounded-lg flex items-center justify-center hover:bg-[#34C759] hover:text-white transition-all"><Icon name="check" size={10} /></button>}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
		
		
        const EditModal = ({ task, onSave, onClose, onDelete }) => {
                    const [title, setTitle] = useState(task.title);
                    const [desc, setDesc] = useState(task.description);
                    const [priority, setPriority] = useState(task.priority);
                    const [status, setStatus] = useState(task.status);
        
                    return (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/20 backdrop-blur-md">
                            <div className="absolute inset-0" onClick={onClose}></div>
                            <div className="bg-white w-full max-w-md rounded-[50px] shadow-2xl overflow-hidden border border-white transform animate-slide relative z-10">
                                {/* å¤´éƒ¨ï¼šç¼©å°äº†é«˜åº¦ */}
                                <div className="px-10 py-6 border-b border-gray-50 flex justify-between items-center bg-gray-50/30">
                                    <h3 className="font-black text-[12px] uppercase tracking-[0.2em] text-gray-400">ç¼–è¾‘ä»»åŠ¡è¯¦æƒ…</h3>
                                    <button onClick={onClose} className="p-2 text-gray-300 hover:text-gray-800 transition-colors"><Icon name="x" size={24} /></button>
                                </div>
                                
                                {/* å†…å®¹åŒºï¼šè°ƒæ•´äº† pt-4 (é¡¶éƒ¨é—´è·) å’Œ space-y-5 (å…ƒç´ é—´è·) */}
                                <div className="px-10 pb-10 pt-4 space-y-5">
                                    {/* æ ‡é¢˜è¾“å…¥ */}
                                    <div className="space-y-1.5">
                                        <label className="text-[10px] font-black text-gray-400 uppercase ml-4 tracking-widest">ä»»åŠ¡åç§°</label>
                                        <div className="group bg-gray-50 rounded-[22px] p-0.5 border-2 border-transparent focus-within:border-[#FF9F0A]/20 focus-within:bg-white focus-within:shadow-md transition-all">
                                            <input className="w-full bg-transparent p-3.5 font-bold text-gray-800 outline-none text-lg" value={title} onChange={e => setTitle(e.target.value)} />
                                        </div>
                                    </div>
        
                                    {/* æè¿°è¾“å…¥ */}
                                    <div className="space-y-1.5">
                                        <label className="text-[10px] font-black text-gray-400 uppercase ml-4 tracking-widest">å¤‡æ³¨å†…å®¹è¯´æ˜</label>
                                        <div className="group bg-gray-50 rounded-[22px] p-0.5 border-2 border-transparent focus-within:border-[#FF9F0A]/20 focus-within:bg-white focus-within:shadow-md transition-all">
                                            <textarea className="w-full bg-transparent p-3.5 text-sm font-medium text-gray-600 outline-none h-28 resize-none" value={desc} onChange={e => setDesc(e.target.value)} />
                                        </div>
                                    </div>
        
                                    {/* é€‰æ‹©å™¨ç»„ */}
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="space-y-1.5">
                                            <label className="text-[10px] font-black text-gray-400 uppercase ml-4 tracking-widest">ä¼˜å…ˆçº§</label>
                                            <div className="bg-gray-50 rounded-[18px] p-0.5 border-2 border-transparent focus-within:border-[#FF9F0A]/20 focus-within:bg-white transition-all">
                                                <select className="w-full bg-transparent p-3 text-[11px] font-black uppercase outline-none cursor-pointer" value={priority} onChange={e => setPriority(e.target.value)}>
                                                    <option value="high">ğŸ”´ é‡è¦ä¸”ç´§æ€¥</option>
                                                    <option value="medium">ğŸŸ  æ™®é€šäº‹é¡¹</option>
                                                    <option value="low">ğŸ”µ ç¨åå¤„ç†</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div className="space-y-1.5">
                                            <label className="text-[10px] font-black text-gray-400 uppercase ml-4 tracking-widest">å½“å‰çŠ¶æ€</label>
                                            <div className="bg-gray-50 rounded-[18px] p-0.5 border-2 border-transparent focus-within:border-[#FF9F0A]/20 focus-within:bg-white transition-all">
                                                <select className="w-full bg-transparent p-3 text-[11px] font-black uppercase outline-none cursor-pointer" value={status} onChange={e => setStatus(e.target.value)}>
                                                    <option value="todo">å¾…å¤„ç†</option>
                                                    <option value="in_progress">è¿›è¡Œä¸­</option>
                                                    <option value="done">å·²å®Œæˆ</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
        
                                    {/* åº•éƒ¨æŒ‰é’® */}
                                    <div className="pt-2 flex gap-4">
                                        <button onClick={onClose} className="flex-1 py-4 bg-gray-100 text-gray-500 rounded-[22px] font-black text-[12px] uppercase hover:bg-gray-200 transition-colors">å–æ¶ˆ</button>
                                        <button onClick={() => onSave({ ...task, title, description: desc, priority, status })} className="flex-[2] py-4 bg-[#7DCEA0] text-white rounded-[22px] font-black text-[12px] uppercase shadow-xl shadow-[#7DCEA0]/30 hover:scale-[1.02] active:scale-95 transition-all">ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
